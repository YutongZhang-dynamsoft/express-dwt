/*! 20200811* Dynamsoft JavaScript Library
* Product: Dynamsoft Web Twain
* Web Site: http://www.dynamsoft.com
*
* Copyright 2020, Dynamsoft Corporation 
* Author: Dynamsoft R&D Department
*
* Version: 16.1.1
*
* Module: addon/camera
* final js: build\addon\dynamsoft.webtwain.addon.camera.js
*/
;var Dynamsoft=self.Dynamsoft||{WebTwainEnv:{}};Dynamsoft.aryAddonReadyFun=Dynamsoft.aryAddonReadyFun||[];Dynamsoft.AddonReady=Dynamsoft.AddonReady||function(a){Dynamsoft.aryAddonReadyFun.push(a)};Dynamsoft.CameraVerInName="16.1.0.0720";Dynamsoft.AddonReady(function(c,b){if(!c.product.bHTML5Edition){return}var a=function(e){var g=c.html5.Funs,d;var f=function(){this._stwain=e;this._viewer=new CameraViewer()};f.prototype._checkLic=function(){var h=true;if(!c.License.checkProductKey(this._stwain,{Webcam:true},true)){h=false}if(h&&!c.License.checkProductKey(this._stwain,{Webcam:true,Wasm:true},true)){h=false}if(h){return false}else{return{errorCode:this._stwain._errorCode,errorMessage:this._stwain._errorString}}};f.prototype.getSourceList=function(){var h=this._checkLic();if(h){return c.Promise.reject(h)}return this._viewer.getSourceList()};f.prototype.selectSource=function(h){var i=this._checkLic();if(i){return c.Promise.reject(i)}this._viewer.hide();return this._viewer.selectSource(h)};f.prototype.closeSource=function(){var h=this._checkLic();if(h){return c.Promise.reject(h)}this._viewer.hide();return this._viewer.closeSource()};f.prototype.play=function(i,j){var n=this._checkLic(),l,h;if(n){return c.Promise.reject(n)}if(this._stwain._ImgManager.getView().GetWebViewer().bShowImageEditForFullScreen){return c.Promise.resolve()}var o=i;if(!o){if(this._stwain.Viewer.bOnlyShowThumbnailsView||!this._stwain.Viewer.showMain){var m=c.one(["#showImageArea",this._stwain.Viewer.postfix].join(""));if(m&&m.length>0){if(m[0].className.indexOf("DVS_disabled")<0){o=m[0]}}}else{var k=c.one(["#container",this._stwain.Viewer.postfix].join(""));if(k&&k.length>0){if(k[0].className.indexOf("DVS_disabled")<0){o=k[0]}}}}if(!o){this._viewer.unbindUI();this._viewer.closeSource().then(function(){},function(){})}else{if(typeof j=="object"){l=j.width;h=j.height}this._viewer.show()}return this._viewer.play(o,l,h)};f.prototype.pause=function(){return this._viewer.pause()};f.prototype.resume=function(){return this._viewer.resume()};f.prototype.getStatus=function(){var h=this._checkLic();if(h){return c.Promise.reject(h)}return this._viewer.getStatus()};f.prototype.capture=function(){var i=this._checkLic(),h=this._stwain;if(i){return c.Promise.reject(i)}return this._viewer.capture().then(function(j){return new c.Promise(function(o,n){var k=j,l=-1,m=Dynamsoft.EnumDWT_ImageType;if(h._bLocalService){if(c.isString(k.type)){if(k.type=="application/pdf"){l=m.IT_PDF}else{if(k.type=="image/png"){l=m.IT_PNG}else{if(k.type=="image/jpeg"){l=m.IT_JPG}else{if(k.type=="image/bmp"){l=m.IT_BMP}else{if(k.type=="image/tiff"){l=m.IT_TIF}}}}}}h.__LoadImageFromBytes(k,l,"",true,function(){o(k)},n)}else{h._innerSendToMobile("LoadImageFromBinary",[k],0,function(){o(k)},n)}})})};f.prototype.stop=function(){this._viewer.hide();return this._viewer.stop()};f.prototype.show=function(){return this._viewer.show()};f.prototype.hide=function(){return this._viewer.hide()};f.prototype.getCurrentResolution=function(){return this._viewer.getCurrentResolution()};f.prototype.getCurrentSource=function(){return this._viewer.getCurrentSource()};f.prototype.getResolution=function(){var h=this._checkLic();if(h){return c.Promise.reject(h)}return this._viewer.getResolution()};f.prototype.setResolution=function(h){var i=this._checkLic();if(i){return c.Promise.reject(i)}return this._viewer.setResolution(h)};e.__addon=e.__addon||{};e.__addon.Camera=new f()};if(c.DynamicLoadAddonFuns){c.DynamicLoadAddonFuns.push(a)}});/*! For license information please see dcs.js.LICENSE.txt */
!function(t){var e={};function i(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,i),o.l=!0,o.exports}i.m=t,i.c=e,i.d=function(t,e,r){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)i.d(r,o,function(e){return t[e]}.bind(null,o));return r},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=1)}([function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={ErrorMessage:{OK:{code:0,message:"Successful"},HTTPS_REQUIRED:{code:-4201,message:"HTTPS is required for accessing cameras."},MEDIADEVICES_NOT_IMPL:{code:-4202,message:"The current browser has not implemented the MediaDevices interface."},GETUSERMEDIA_NOT_IMPL:{code:-4203,message:"The current browser has not implemented the getUserMedia interface."},NO_MEMORY:{code:-4204,message:"Not enough memory for this operation."},NO_CAMERA_SELECTED:{code:-4205,message:"No camera is selected."},VIDEO_ELEMENT_REQUIRED:{code:-4206,message:"A Video element is required for this operation."},CAMERA_PLUG_OUT:{code:-4207,message:"The camera is not plugged in."},CAMERA_NOT_OPEN:{code:-4208,message:"The camera is not open."},CAMERA_SETTINGS_NOT_SUPPORT:{code:-4209,message:"The current browser does not support camera settings."},FAILED_GET_USERMEDIA:{code:-4210,message:"Failed to get camera input."},SOURCE_NOT_FOUND:{code:-4211,message:"The camera source can not be found."},VIDEO_NOT_PLAY:{code:-4214,message:"The video must be playing for the capture operation to work."},VIDEO_NOT_STOP:{code:-4215,message:"The video is already playing. Please stop the video before attempting to play it again to a different container."},NO_CAMERA:{code:-4216,message:"No camera is found."}}}},function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var o=r(i(2));i(10),e.default=o.default,window.CameraViewer=o.default,HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(t,e,i){for(var r=atob(this.toDataURL(e,i).split(",")[1]),o=r.length,n=new Uint8Array(o),s=0;s<o;s++)n[s]=r.charCodeAt(s);t(new Blob([n],{type:e||"image/png"}))}})},function(t,e,i){"use strict";function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var o=this&&this.__awaiter||function(t,e,i,r){return new(i||(i=Promise))((function(o,n){function s(t){try{c(r.next(t))}catch(t){n(t)}}function a(t){try{c(r.throw(t))}catch(t){n(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,a)}c((r=r.apply(t,e||[])).next())}))},n=this&&this.__generator||function(t,e){var i,r,o,n,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return n={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function a(n){return function(a){return function(n){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,r&&(o=2&n[0]?r.return:n[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,n[1])).done)return o;switch(r=0,o&&(n=[2&n[0],o.value]),n[0]){case 0:case 1:o=n;break;case 4:return s.label++,{value:n[1],done:!1};case 5:s.label++,r=n[1],n=[0];continue;case 7:n=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==n[0]&&2!==n[0])){s=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3])){s.label=n[1];break}if(6===n[0]&&s.label<o[1]){s.label=o[1],o=n;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(n);break}o[2]&&s.ops.pop(),s.trys.pop();continue}n=e.call(t,s)}catch(t){n=[6,t],r=0}finally{i=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,a])}}},s=this&&this.__spreadArrays||function(){for(var t=0,e=0,i=arguments.length;e<i;e++)t+=arguments[e].length;var r=Array(t),o=0;for(e=0;e<i;e++)for(var n=arguments[e],s=0,a=n.length;s<a;s++,o++)r[o]=n[s];return r},a=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var c=a(i(3)),h=a(i(4)),l=i(6),u=a(i(7)),d=i(8),p=a(i(9)),f=a(i(0)).default.ErrorMessage,v=function(){function t(t,e,i){this._cropComponent=null,this._isDrawing=!1,this._iResolution=null,this._camera=null,this._tempCanvas=document.createElement("canvas"),this.errorCode=0,this.errorMessage="Successful.",this._cropArea=[],this._logs="",this._videoContainer=null,this._video=null,this._resultImg=null,this._controlBox=null,this._cvsDrawArea=null,this._divScanArea=null,this._divScanLight=null,this._btnClose=null,this.regionMaskFillStyle="rgba(0,0,0,0.5)",this.regionMaskStrokeStyle="rgb(254,142,20)",this.regionMaskLineWidth=2,this.areaFillStyle="rgba(254,180,32,0.3)",this.lineStrokeStyle="rgba(254,180,32,0.9)",this.lineWidth=1,this._pub=new d.PublishSubscribe,this._cropComponent=new l.Crop({}),this._iResolution={deviceId:e,resolution:i},t&&this.bindUI(document.getElementById(t),!1),this._cameraManageInit(),this._bindEvents()}return t.prototype._bindEvents=function(){var t=this;[["onLog",this._onLog],["onResolutionChanged",this.show],["onCameraChanged",this._cameraChangedHandler],["onCameraSelChanged",this._onCameraSelChanged],["onPlayed",this.drawRegionsults],["onThrowError",this._throwError],["onParaTypeError",this._throwParaTypeError],["onParaValueError",this._throwParaValueError]].forEach((function(e){t.on(e[0],e[1])})),window.addEventListener("resize",(function(){t.drawRegionsults()}))},t.prototype._cameraChangedHandler=function(t){this._camera&&(c.default.cameraExist(this._camera._cameraInfo,t)||(this.emit("onLog","camera plug out."),this._camera.setPlugout(),this.emit("onThrowError",f.CAMERA_PLUG_OUT)))},t.prototype._onLog=function(t){this._logs+=t+"\n"},t.prototype._cameraManageInit=function(){this._cameraManager=new c.default(this._pub)},t.prototype.destroy=function(){this.off("onLog"),this.unbindUI(),this._closeCamera(),this._cameraManager.destroy(),this.unbindRealTimeRender()},t.prototype.getVideoElement=function(){return this._video},t.prototype._throwError=function(t){if(t.code&&t.message)throw this.errorCode=t.code,this.errorMessage=t.message,u.default.cameraException(t)},t.prototype._throwParaTypeError=function(t,e){throw this.errorCode=-4212,this.errorMessage="Argument of type '"+t+"' is not assignable to parameter of type '"+e+"'.",u.default.cameraException({code:this.errorCode,message:this.errorMessage})},t.prototype._throwParaValueError=function(t,e){throw this.errorCode=-4213,this.errorMessage="The argument '"+t+"' is not valid for the parameter '"+e+"'",u.default.cameraException({code:this.errorCode,message:this.errorMessage})},t.prototype.show=function(){this._checkCamera(),this._videoContainer&&"none"==this._videoContainer.style.display&&(this._videoContainer.style.display=""),this.drawRegionsults(null)},t.prototype.hidden=function(){return!!this._videoContainer&&"none"==this._videoContainer.style.display},t.prototype.hide=function(){this._videoContainer&&(this._videoContainer.style.display="none")},t.prototype.playDirectly=function(t,e,i){return o(this,void 0,void 0,(function(){var r,o;return n(this,(function(n){switch(n.label){case 0:return r={},this._camera?this._camera.playing()?[3,2]:[4,this._camera.play(e,i)]:[3,4];case 1:return r=n.sent(),[3,3];case 2:r=this._camera._curResolution,n.label=3;case 3:return[3,8];case 4:return(o=this._cameraManager._allCamerasInfo).length?[3,6]:[4,this._cameraManager.getAllCamerasInfo()];case 5:o=n.sent(),n.label=6;case 6:return this._camera=new h.default(null,this._video,o,t,this._pub),[4,this._camera.play(e,i)];case 7:r=n.sent(),n.label=8;case 8:return[2,r]}}))}))},t.prototype.playing=function(){return!!this._camera&&this._camera.playing()},t.prototype.paused=function(){return!!this._camera&&this._camera.paused()},t.prototype._closeCamera=function(){this._camera&&(this._camera.destroy(),this._camera=null)},t.prototype._checkCamera=function(){return!!this._camera&&void 0},t.prototype.bindResolutionsSelector=function(t){return!!this._camera&&this._camera.bindResolutionsSelector(t)},t.prototype.unbindResolutionsSelector=function(){return!!this._camera&&this._camera.unbindResolutionsSelector()},t.prototype.drawRegionsults=function(t){if(this._video&&this._cvsDrawArea){var e=this._cvsDrawArea;if(this.calPixelRatio()){e.width=e.clientWidth,e.height=e.clientHeight;var i=e.getContext("2d");i.strokeStyle=this.lineStrokeStyle,i.strokeRect(0,0,e.width,e.height)}}},t.prototype.calPixelRatio=function(){if(this._video&&this._cvsDrawArea){var t=this._video,e=t.videoWidth,i=t.videoHeight,r=t.clientWidth,o=t.clientHeight;if(0===r||0===o)return 0;var n=Math.max(r/e,o/i);return n===1/0&&(n=0),this._pixelRatio=n,n}},t.prototype._clearCanvasRect=function(){this._cvsDrawArea&&this._cvsDrawArea.getContext("2d").clearRect(0,0,this._cvsDrawArea.width,this._cvsDrawArea.height)},t.prototype._clearRegionsults=function(){this._cvsDrawArea&&(this._cvsDrawArea.width=this._cvsDrawArea.height=0)},t.prototype.bindCameraSelector=function(t){return this._cameraManager.bindCameraSelector(t)},t.prototype.unbindCameraSelector=function(){return this._cameraManager.unbindCameraSelector()},t.prototype._onCameraSelChanged=function(t){var e=this;this.setCurrentCamera(t).then((function(t){e.hide(),t.getResolutions()}))},t.prototype.setCurrentCamera=function(t,e){return o(this,void 0,void 0,(function(){var i;return n(this,(function(r){switch(r.label){case 0:return this._closeCamera(),(i=this._cameraManager._allCamerasInfo)?[3,2]:[4,this._cameraManager.getAllCamerasInfo()];case 1:i=r.sent(),r.label=2;case 2:return this._camera=new h.default(t,this._video,i,e,this._pub),[2,this._camera]}}))}))},t.prototype.getCurrentCamera=function(){return this._camera},t.prototype.on=function(t,e){this._pub.on(t,e.bind(this))},t.prototype.emit=function(t){for(var e,i=[],r=1;r<arguments.length;r++)i[r-1]=arguments[r];(e=this._pub).emit.apply(e,s([t],i))},t.prototype.off=function(t,e){this._pub.off(t,e)},t.prototype.bindUI=function(t,e){var i=this;if((void 0===e&&(e=!0),this.unbindUI(),this._licenseCallback)&&0!==this._licenseCallback().errorCode)return!1;if(t){if(""===t.style.position&&(t.style.position="relative"),this._videoContainer=document.createElement("div"),this._videoContainer.setAttribute("class","dynamsoft-cvs-container"),t.appendChild(this._videoContainer),this._video=document.createElement("video"),this._video.setAttribute("class","dynamsoft-video"),this._video.setAttribute("playsinline","true"),this._videoContainer.appendChild(this._video),this._camera&&(this._camera._videoEle=this._video),this._cvsDrawArea=document.createElement("canvas"),this._cvsDrawArea.setAttribute("class","dynamsoft-cvs-drawarea"),this._videoContainer.appendChild(this._cvsDrawArea),this._resultImg=document.createElement("img"),this._resultImg.setAttribute("class","dynamsoft-resultImg"),this._videoContainer.appendChild(this._resultImg),e){var r=document.createElement("div");r.setAttribute("class","dynamsoft-cvs-exit ds-dvs-ui-iconfont ds-dvs-ui-exitMutiple"),this._videoContainer.appendChild(r),r&&r.addEventListener("click",(function(){i.emit("onExitCamera")}))}return this.bindControlBox(),!0}},t.prototype.unbindUI=function(){if(this._clearRegionsults(),this._videoContainer){var t=this._videoContainer.parentNode;t&&t.removeChild(this._videoContainer)}this._videoContainer=null,this._video=null,this._cvsDrawArea=null,this._divScanLight=null,this._divScanLight=null,this._btnClose=null},t.prototype.getImageData=function(){this._drawRealCameraArea();var t=this._tempCanvas;return t.getContext("2d").getImageData(0,0,t.width,t.height)},t.prototype.getBlobData=function(t){if(t=t||this._tempCanvas,this._video)return new Promise((function(e){t.toBlob((function(t){e(t)}))}))},t.prototype._drawRealCameraArea=function(){if(this._video){var t=this._tempCanvas,e=this._cvsDrawArea,i=this._pixelRatio,r=e.width/i,o=e.height/i;t.width=r,t.height=o;var n=(this._video.videoWidth-r)/2,s=(this._video.videoHeight-o)/2;t.getContext("2d").drawImage(this._video,n,s,r,o,0,0,r,o)}},t.prototype.emptyTempCanvas=function(){var t=this._tempCanvas;t.width=0,t.height=0},t.prototype.bindRealTimeRender=function(t){var e=this;if(this.unbindRealTimeRender(),!this._areaDetectFn)return!1;var i=1e3/t;this._isDrawing=!0;return function t(i){e.freeCropTimer=setTimeout((function(){return o(e,void 0,void 0,(function(){return n(this,(function(e){switch(e.label){case 0:return this._isDrawing?[4,this.drawCropArea()]:[3,2];case 1:e.sent(),t(i),e.label=2;case 2:return[2]}}))}))}),i)}(i),!0},t.prototype.unbindRealTimeRender=function(){clearTimeout(this.freeCropTimer),this._isDrawing=!1,this.drawRegionsults()},t.prototype.bindAreaDetectFunction=function(t){return!!p.default.isFunction(t)&&(this._areaDetectFn=t,!0)},t.prototype.bindPerspectiveFunction=function(t){return!!p.default.isFunction(t)&&(this._perspectiveCallback=t,!0)},t.prototype.bindLicenseCallback=function(t){return!!p.default.isFunction(t)&&(this._licenseCallback=t,!0)},t.prototype.detectArea=function(){return o(this,void 0,void 0,(function(){var t,e;return n(this,(function(i){switch(i.label){case 0:return t=this.getImageData(),e=[],this._areaDetectFn?[4,this._areaDetectFn(t.data,t.width,t.height)]:[3,2];case 1:e=i.sent(),t=null,i.label=2;case 2:return[2,e.slice(0)]}}))}))},t.prototype.perspective=function(t){return o(this,void 0,void 0,(function(){var e;return n(this,(function(i){return Array.isArray(t)?(e=this.getImageData(),this._perspectiveCallback?[2,this._perspectiveCallback.call(this,e.data,t,e.width,e.height)]:[2]):[2,!1]}))}))},t.prototype.drawArea=function(t){var e=this,i=this._cvsDrawArea;if(i){var r=i.getContext("2d");return t?(this._clearCanvasRect(),r.strokeStyle=this.areaFillStyle,r.fillStyle=this.areaFillStyle,r.lineWidth=5,r.clearRect(0,0,i.width,i.height),r.save(),r.beginPath(),r.moveTo(t[0][0]*this._pixelRatio,t[0][1]*this._pixelRatio),t.forEach((function(i,o){var n=(o+1)%4;r.lineTo(t[n][0]*e._pixelRatio,t[n][1]*e._pixelRatio)})),r.stroke(),r.closePath(),r.restore(),!0):(r.clearRect(0,0,i.width,i.height),!1)}},t.prototype.drawCropArea=function(){return o(this,void 0,void 0,(function(){var t,e;return n(this,(function(i){switch(i.label){case 0:return[4,this.detectArea()];case 1:return t=i.sent(),Array.isArray(t)&&t.length&&this._isDrawing?(e=[t.slice(0,2),t.slice(2,4),t.slice(4,6),t.slice(6,8)],this.drawArea(e),[2,!0]):[2,!1]}}))}))},t.prototype.bindControlBox=function(t){if(!(document.getElementById(t)||this._controlBox))return!1;this.bindCustomBox(t,{blank1:{className:"camera-empty"},captureBtn:{className:"camera-main",iconClass:"ds-dvs-ui-zhaoxiangji",onButtonClick:"onCapture"},detectBtn:{className:"camera-right",iconClass:"ds-dvs-ui-shibie-chuanti",onButtonClick:"onDetect"}})},t.prototype.bindConfirmBox=function(t){if(!(document.getElementById(t)||this._controlBox))return!1;this.bindCustomBox(t,{remakeBtn:{className:"camera-left",iconClass:"ds-dvs-ui-shangyibu",onButtonClick:"onRemake"},blank1:{className:"camera-editEmpty"},perspectiveBtn:{className:"camera-right",iconClass:"ds-dvs-ui-xiayibu",onButtonClick:"onPerspective"}})},t.prototype.bindSaveBox=function(t){if(!(document.getElementById(t)||this._controlBox))return!1;this.bindCustomBox(t,{backBtn:{className:"camera-around",iconClass:"ds-dvs-ui-shangyibu",onButtonClick:"onBack"},blank1:{className:"camera-saveEmpty"},remakeBtn:{className:"camera-around",iconClass:"ds-dvs-ui-zhongpai",onButtonClick:"onRemake"},confirmBtn:{className:"camera-around",iconClass:"ds-dvs-ui-lijiquerenx",onButtonClick:"onConfirm"}})},t.prototype.bindCustomBox=function(t,e,i){var r=this;e=e||{};var o=document.getElementById(t)||this._controlBox;if(!o)return!1;var n={};p.default.mergeJSON(e,n);var s="<div id='controlwrapper' class='controlwrapper "+p.default.rValue(i)+"'>";for(var a in n){var c=n[a];c=c||{},s+="<div id='"+a+"' class='"+a+"  "+(p.default.rValue(c.className)?p.default.rValue(c.className):"camera-empty")+"'>",s+="<div class='ds-dvs-ui-iconfont "+p.default.rValue(c.iconClass)+"'></div>",s+="<text>"+p.default.rValue(c.text)+"</text>",s+="</div>"}s+="</div>",o.innerHTML=s;var h=function(t){var e=n[t];e=e||{};var i=p.default.rValue(e.onButtonClick),o=document.getElementById(t);if(!o||!i)return"continue";o.addEventListener("click",(function(){r.emit(i)})),o.addEventListener("touchstart",(function(t){}))};for(var a in n)h(a);document.body.addEventListener("touchstart",(function(){}))},t.prototype.showResultImage=function(t){this._resultImg&&(this._resultImg.style.display="block",this._resultImg.src=t,this._video.style.display="none")},t.prototype.hideResultImage=function(t){if(this._resultImg){var e=this._resultImg.src;e&&!t&&URL.revokeObjectURL(e),this._resultImg.style.display="none",this._resultImg.src="",this._video.style.display=""}},t.prototype._cropInit=function(){var t=this._video,e=this._cropComponent,i=this._cvsDrawArea.getBoundingClientRect();e.setValidAreaSize(t.clientWidth,t.clientHeight),e.setImageSize(t.clientWidth,t.clientWidth),e.bindCallback(this._cropCallback.bind(this)),e.canvasLeft=i.left,e.canvasTop=i.top;var r="mousedown",o="mousemove",n="mouseup";"ontouchstart"in window&&(r="touchstart",o="touchmove",n="touchend"),this._cvsDrawArea&&(this._cvsDrawArea.addEventListener(r,(function(t){e.onStartHandler(t)})),this._cvsDrawArea.addEventListener(o,(function(t){e.onMoveHandler(t)})),this._cvsDrawArea.addEventListener(n,(function(t){e.onEndHandler(t)})))},t.prototype._cropCallback=function(t){var e=this._cvsDrawArea;if(e){var i=e.getContext("2d");if(!t)return i.clearRect(0,0,e.width,e.height),!1;this._clearCanvasRect(),i.strokeStyle="white",i.lineWidth=5,i.clearRect(0,0,e.width,e.height),i.save();var r=this._pixelRatio;i.beginPath(),i.moveTo(t[0]*r,t[1]*r);for(var o=1;o<=4;o++){var n=2*o%8;i.lineTo(t[n]*r,t[n+1]*r)}i.closePath(),i.stroke();for(o=0;o<4;o++){var s=2*(o+1)%8,a=(t[n=2*o%8]+t[s])*r/2,c=(t[n+1]+t[s+1])*r/2;i.beginPath(),i.arc(t[n]*r,t[n+1]*r,5,0,2*Math.PI),i.closePath(),i.stroke(),i.beginPath(),i.arc(a,c,5,0,2*Math.PI),i.closePath(),i.stroke()}return i.restore(),!0}},t.prototype.getSourceList=function(){return this._cameraManager.getAllCamerasInfo()},t.prototype.selectSource=function(t){return o(this,void 0,void 0,(function(){var e;return n(this,(function(i){switch(i.label){case 0:return p.default.isString(t)||this._throwParaTypeError(r(t),"string"),this._cameraManager._allCamerasInfo&&0!==this._cameraManager._allCamerasInfo.length?[3,2]:[4,this._cameraManager.getAllCamerasInfo()];case 1:i.sent(),i.label=2;case 2:return(e=this._cameraManager.selectCamera(t))||this.emit("onThrowError",f.SOURCE_NOT_FOUND),[4,this.setCurrentCamera(e)];case 3:return i.sent(),[2,e]}}))}))},t.prototype.getCurrentSource=function(){return o(this,void 0,void 0,(function(){return n(this,(function(t){return this._camera?[2,this._camera._cameraInfo]:[2,null]}))}))},t.prototype.closeSource=function(){var t=this;return new Promise((function(e,i){if(t._camera){var r=t._camera._cameraInfo;t._camera.destroy(),t._camera=null,e(r)}else t.emit("onThrowError",f.NO_CAMERA_SELECTED)}))},t.prototype.play=function(t,e,i){return o(this,void 0,void 0,(function(){return n(this,(function(o){return void 0!==t&&(p.default.isElement(t)?this._videoContainer&&t===this._videoContainer.parentNode||(this.playing()&&this.emit("onThrowError",f.VIDEO_NOT_STOP),this.bindUI(t,!1)):this._throwParaTypeError(r(t),"HTMLElement")),[2,this.playDirectly(null,e,i)]}))}))},t.prototype.capture=function(){return o(this,void 0,void 0,(function(){var t;return n(this,(function(e){return this._camera||this.emit("onThrowError",f.NO_CAMERA_SELECTED),this._video?(this.playing()||this._throwError(f.VIDEO_NOT_PLAY),t=this._tempCanvas,this.calPixelRatio(),this._drawRealCameraArea(),[2,new Promise((function(e,i){t.toBlob((function(i){t.width=0,t.height=0,e(i)}))}))]):(this.emit("onThrowError",f.VIDEO_ELEMENT_REQUIRED),[2])}))}))},t.prototype.pause=function(){this._camera&&this._camera.pause()},t.prototype.stop=function(){this._camera&&(this._clearCanvasRect(),this._camera.stop())},t.prototype.resume=function(){this._camera&&this._camera.resume()},t.prototype.getStatus=function(){return this._camera?this.playing()?this.paused()?"paused":"playing":"stopped":""},t.prototype.getResolution=function(){return o(this,void 0,void 0,(function(){return n(this,(function(t){switch(t.label){case 0:return this._camera?[4,this._camera.getResolutions()]:[3,2];case 1:return[2,t.sent()];case 2:this.emit("onThrowError",f.NO_CAMERA_SELECTED),t.label=3;case 3:return[2]}}))}))},t.prototype.setResolution=function(t){return o(this,void 0,void 0,(function(){return n(this,(function(e){return this._camera?(p.default.isObject(t)||this._throwParaTypeError(r(t),"Object"),t.width>0&&t.height>0||this._throwParaValueError(JSON.stringify(t),"resolution"),this.playing()?[2,this._camera.setResolution(t.width,t.height)]:(this._camera._curResolution=t,[2,t])):(this.emit("onThrowError",f.NO_CAMERA_SELECTED),[2])}))}))},t.prototype.getCurrentResolution=function(){return o(this,void 0,void 0,(function(){return n(this,(function(t){return this._camera?[2,this._camera._curResolution]:(this.emit("onThrowError",f.NO_CAMERA_SELECTED),[2])}))}))},t}();e.default=v},function(t,e,i){"use strict";function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var o=this&&this.__awaiter||function(t,e,i,r){return new(i||(i=Promise))((function(o,n){function s(t){try{c(r.next(t))}catch(t){n(t)}}function a(t){try{c(r.throw(t))}catch(t){n(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,a)}c((r=r.apply(t,e||[])).next())}))},n=this&&this.__generator||function(t,e){var i,r,o,n,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return n={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function a(n){return function(a){return function(n){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,r&&(o=2&n[0]?r.return:n[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,n[1])).done)return o;switch(r=0,o&&(n=[2&n[0],o.value]),n[0]){case 0:case 1:o=n;break;case 4:return s.label++,{value:n[1],done:!1};case 5:s.label++,r=n[1],n=[0];continue;case 7:n=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==n[0]&&2!==n[0])){s=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3])){s.label=n[1];break}if(6===n[0]&&s.label<o[1]){s.label=o[1],o=n;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(n);break}o[2]&&s.ops.pop(),s.trys.pop();continue}n=e.call(t,s)}catch(t){n=[6,t],r=0}finally{i=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,a])}}},s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var a=s(i(0)).default.ErrorMessage,c=function(){function t(t){var e=this;this._cameraPermission=!1,this._allCamerasInfo=[],this._selCameraInfo=null,this._cameraSelector=null,this._onCameraSelChange=function(){var t=!0;e._selCameraInfo&&e._cameraSelector.options.length>0&&e._selCameraInfo.deviceId==e._cameraSelector.value&&(t=!1);var i={},r=e._cameraSelector.selectedOptions;t&&(r&&r.length>0?(i.deviceId=r[0].value,i.label=r[0].innerText):i=e._allCamerasInfo[0]),i.deviceId?e._selCameraInfo=i:i=null,t&&e._fireCameraSelChanged(i)},this._pub=t,this._trackCameraDeviceChanged(),this._bindEvents()}return t.prototype._requestCamera=function(){return o(this,void 0,void 0,(function(){var t,e;return n(this,(function(i){switch(i.label){case 0:if(this._cameraPermission)return[2,!1];void 0===navigator.mediaDevices&&(location.origin.startsWith("https://")?this._pub.emit("onThrowError",a.MEDIADEVICES_NOT_IMPL):this._pub.emit("onThrowError",a.HTTPS_REQUIRED)),void 0===navigator.mediaDevices.getUserMedia&&this._pub.emit("onThrowError",a.GETUSERMEDIA_NOT_IMPL),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,navigator.mediaDevices.getUserMedia({video:{width:{ideal:1280},height:{ideal:720},facingMode:{ideal:"environment"}}})];case 2:return(t=i.sent())&&(t.getTracks().forEach((function(t){t.stop()})),this._cameraPermission=!0),[3,4];case 3:throw e=i.sent(),this._pub.emit("onThrowError",e),e;case 4:return[2]}}))}))},t.prototype._bindEvents=function(){this._pub.on("onCameraSelChange",this._onCameraSelChange.bind(this))},t.prototype._trackCameraDeviceChanged=function(){var t=this;if(null==navigator.mediaDevices)return!1;navigator.mediaDevices.ondevicechange=function(e){t.getAllCamerasInfo().then((function(e){e&&t._fireCameraChanged(e)}),(function(e){t._pub.emit("onLog",e)}))}},t.prototype.getAllCamerasInfo=function(){return o(this,void 0,void 0,(function(){var t,e,i,r,o,s,a,c,h,l,u,d,p,f,v,_,m;return n(this,(function(n){switch(n.label){case 0:return[4,this._requestCamera()];case 1:return n.sent(),[4,navigator.mediaDevices.enumerateDevices()];case 2:for(t=n.sent(),e=[],i=0,r=0;r<t.length;r++)if("videoinput"==(o=t[r]).kind){for(s=!1,a=0,c=e;a<c.length;a++)if(c[a].deviceId===o.deviceId){s=!0;break}s||((h={}).deviceId=o.deviceId,h.label=!o.label||/^camera\s[0-9]+$/.test(o.label)?"camera "+i++:o.label,e.push(h))}if(l=!0,e.length==this._allCamerasInfo.length){for(u=0,d=0,p=e;d<p.length;d++)for(f=p[d],v=0,_=this._allCamerasInfo;v<_.length;v++)if((m=_[v]).deviceId==f.deviceId&&m.label==f.label){u++;break}l=u!=e.length}return l&&(this._allCamerasInfo=e,this._renderSelCameraInfo()),[2,Promise.resolve(this._allCamerasInfo)]}}))}))},t.prototype._fireCameraChanged=function(t){this._pub.emit("onCameraChanged",t)},t.prototype.destroy=function(){this.unbindCameraSelector(),this._pub.off("onCameraChanged"),this._selCameraInfo=null},t.prototype._fireCameraSelChanged=function(t){this._pub.emit("onCameraSelChanged",t)},t.prototype._renderSelCameraInfo=function(){var t={},e=null;if(this._cameraSelector){for(var i in t.deviceId=this._cameraSelector.value,t.label=this._cameraSelector.innerText,this._cameraSelector.innerHTML="",this._allCamerasInfo){var r=this._allCamerasInfo[i],o=document.createElement("option");o.value=r.deviceId,o.innerText=r.label,this._cameraSelector.append(o),t.deviceId==r.deviceId&&(e=o)}var n=this._cameraSelector.options;if(!e&&this._selCameraInfo&&n.length)for(var s=0;s<n.length;s++)if(this._selCameraInfo.deviceId==n.item(s).value){e=n.item(s);break}e&&(this._cameraSelector.value=e.value),(t.deviceId||0!=this._allCamerasInfo.length)&&this._onCameraSelChange()}},t.prototype.bindCameraSelector=function(t){var e=this;this.unbindCameraSelector(),this._cameraSelector=t||document.createElement("select"),this._cameraSelector&&(this._cameraSelector.addEventListener("change",(function(){e._pub.emit("onCameraSelChange")})),this._renderSelCameraInfo())},t.prototype.unbindCameraSelector=function(){this._cameraSelector&&(this._cameraSelector.removeEventListener("change",this._onCameraSelChange),this._cameraSelector.innerHTML="",this._cameraSelector=null)},t.cameraExist=function(t,e){for(var i=0,r=e;i<r.length;i++){var o=r[i];if(o.deviceId==t.deviceId&&o.label==t.label)return!0}return!1},t.prototype.selectCamera=function(t){if(!t)return null;var e={};if(this._cameraSelector){var i=void 0,o=void 0;if("object"===r(t)){var n=t;n&&(i=n.deviceId,o=n.label)}"string"==typeof t&&(o=i=t);for(var s=this._cameraSelector.options,a=0;a<s.length;a++){if(i==(c=s[a]).value)return e.deviceId=c.value,e.label=c.innerText,this._cameraSelector.value=c.value,e}for(a=0;a<s.length;a++){var c;if(o==(c=s.item(a)).innerText)return e.deviceId=c.value,e.label=c.innerText,this._cameraSelector.value=c.value,e}}if(this._allCamerasInfo)for(var h={deviceId:"",label:""},l=0;l<this._allCamerasInfo.length;l++){var u=this._allCamerasInfo[l];if(t===u.deviceId)return h.deviceId=u.deviceId,h.label=u.label,h}return null},t}();e.default=c},function(t,e,i){"use strict";var r=this&&this.__awaiter||function(t,e,i,r){return new(i||(i=Promise))((function(o,n){function s(t){try{c(r.next(t))}catch(t){n(t)}}function a(t){try{c(r.throw(t))}catch(t){n(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,a)}c((r=r.apply(t,e||[])).next())}))},o=this&&this.__generator||function(t,e){var i,r,o,n,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return n={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function a(n){return function(a){return function(n){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,r&&(o=2&n[0]?r.return:n[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,n[1])).done)return o;switch(r=0,o&&(n=[2&n[0],o.value]),n[0]){case 0:case 1:o=n;break;case 4:return s.label++,{value:n[1],done:!1};case 5:s.label++,r=n[1],n=[0];continue;case 7:n=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==n[0]&&2!==n[0])){s=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3])){s.label=n[1];break}if(6===n[0]&&s.label<o[1]){s.label=o[1],o=n;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(n);break}o[2]&&s.ops.pop(),s.trys.pop();continue}n=e.call(t,s)}catch(t){n=[6,t],r=0}finally{i=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,a])}}},n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var s=n(i(0)),a=i(5),c=s.default.ErrorMessage,h=function(){function t(t,e,i,r,o){var n=this;this.videoSettings={video:{width:{ideal:1280},height:{ideal:720},facingMode:{ideal:"environment"}}},this._browserInfo={chrome:!1,firefox:!1,safari:!1,mobile:!1},this._isPlugOut=!1,this._resolutionSelector=null,this._cameraInfo=null,this._allCameras=null,this._videoTrack=null,this._allResolutions=[],this._curResolution=null,this._videoEle=null,this._onResolutionSelChange=function(){var t=!0;if(n._curResolution&&n._resolutionSelector.options.length>0&&JSON.stringify(n._curResolution)==n._resolutionSelector.value&&(t=!1),n._resolutionSelector.options.length>0){var e={};if(n._resolutionSelector&&-1!=n._resolutionSelector.selectedIndex){var i=n._resolutionSelector.options[n._resolutionSelector.selectedIndex];e=JSON.parse(i.value)}n.play(e.width,e.height).then((function(){t&&n._fireResolutionChanged(e.width,e.height,e.type)})).catch((function(t){n._fireLog("Play video failed: "+(t.message||t))}))}},this._pub=o,this._initBrowserInfo(r),t?this._cameraInfo=t:(this._cameraInfo={},this._cameraInfo.deviceId="",this._cameraInfo.label=""),e&&(this._videoEle=e),this._allCameras=i,this._pub.on("onResolutionSelChange",this._onResolutionSelChange.bind(this))}return t.prototype.setPlugout=function(){this._isPlugOut=!0},t.prototype._checkPlugout=function(){this._isPlugOut&&this._pub.emit("video-error",c.CAMERA_PLUG_OUT)},t.prototype._initBrowserInfo=function(t){this._browserInfo=t||this._getBrowser()},t.prototype._getBrowser=function(){var t=new a.BrowserDetect;return{safari:"Safari"==t.browser,chrome:"Chrome"==t.browser,firefox:"Firefox"==t.browser,mobile:t.detectmobilebrowser()}},t.prototype._fireResolutionChanged=function(t,e,i){var r={};r.width=t,r.height=e,r.type=i,this._pub.emit("onResolutionChanged",r)},t.prototype._renderSelResolution=function(){var t={},e=null;if(this._resolutionSelector){var i=this._resolutionSelector.options[this._resolutionSelector.selectedIndex];i&&(t=JSON.parse(i.value),this._resolutionSelector.innerHTML="")}if(this._resolutionSelector){for(var r=0,o=this._allResolutions;r<o.length;r++){var n=o[r],s=document.createElement("option");s.value=JSON.stringify(n),s.innerText=n.width+" x "+n.height,this._resolutionSelector.append(s),t.width==n.width&&t.height==n.height&&(e=s)}var a=this._resolutionSelector.options;if(!e&&this._curResolution&&a.length)for(var c=JSON.stringify(this._curResolution),h=0;h<a.length;h++)if(c==a.item(h).value){e=a.item(h);break}e&&(this._resolutionSelector.value=e.value),(t.width||0!=this._allResolutions.length)&&this._onResolutionSelChange()}},t.prototype.bindResolutionsSelector=function(t){var e=this;this.unbindResolutionsSelector(),this._checkPlugout(),this._resolutionSelector=t||document.createElement("select"),this._resolutionSelector&&(this._resolutionSelector.addEventListener("change",(function(){e._pub.emit("onResolutionSelChange")})),this._renderSelResolution())},t.prototype.unbindResolutionsSelector=function(){this._resolutionSelector&&this._resolutionSelector.removeEventListener("change",this._onResolutionSelChange),this._resolutionSelector=null},t.prototype._getResolution=function(t,e,i,n){return r(this,void 0,void 0,(function(){var r,s,a,h,l,u,d,p;return o(this,(function(o){switch(o.label){case 0:this._checkPlugout(),r={},s=null,a=null,o.label=1;case 1:return o.trys.push([1,5,,6]),this._fireLog("request constraints: width="+e+", height="+i),[4,this._getMediaStream(this._getMediaTrackConstraints(t,e,i,n,!1))];case 2:return(s=o.sent())?(document&&document.createElement?a=document.createElement("video"):this._videoEle?a=this._videoEle:this._pub.emit("onThrowError",c.VIDEO_ELEMENT_REQUIRED),h="exact"==n,!this._browserInfo.firefox&&h?[3,4]:(a.srcObject=s,[4,a.play()])):[2,r];case 3:o.sent(),o.label=4;case 4:return r.type=n,h?(l=s.getVideoTracks()[0],(u=l.getConstraints())&&u.width?(r.height=u.height.exact?u.height.exact:u.height,r.width=u.width.exact?u.width.exact:u.width,this._fireLog("Result constraints: "+JSON.stringify(u))):(d=l.getSettings(),r.height=d.height.exact?d.height.exact:d.height,r.width=d.width.exact?d.width.exact:d.width,this._fireLog("Result constraints(getSettings): "+JSON.stringify(d)))):(r.height=a.videoHeight,r.width=a.videoWidth),[3,6];case 5:return p=o.sent(),this._fireLog("_getResolution exception:"+(p.message||p)),[3,6];case 6:return s?(this._browserInfo.firefox&&(a.srcObject=null),[4,s.getTracks().forEach((function(t){t.stop()}))]):[3,8];case 7:o.sent(),s=null,a=null,o.label=8;case 8:return[2,r]}}))}))},t.prototype.getResolutions=function(){return r(this,void 0,void 0,(function(){var t,e,i,r,n,s,a,c,h,l,u,d,p;return o(this,(function(o){switch(o.label){case 0:if(this._allResolutions.length>0)return[2,this._allResolutions];t=[],e=[{width:320,height:240,type:"exact"},{width:640,height:480,type:"exact"},{width:640,height:360,type:"exact"},{width:800,height:600,type:"exact"},{width:1280,height:720,type:"exact"},{width:1920,height:1080,type:"exact"},{width:2560,height:1440,type:"exact"},{width:3840,height:2160,type:"exact"}],i=null,this._allResolutions=[],r=0,n=e,o.label=1;case 1:return r<n.length?(s=n[r],a=s.height,c=s.width,h=s.type,this._cameraInfo?[4,this._getResolution(this._cameraInfo.deviceId,c,a,h)]:[2,null]):[3,6];case 2:return(i=o.sent())&&i.height&&(!i||!i.height||i.height==a&&i.width==c||i.height==c&&i.width==a)?[3,4]:(this._fireLog("getResolutions try to get ideal resolution: "+c+" x "+a),this._cameraInfo?[4,this._getResolution(this._cameraInfo.deviceId,c,a,"ideal")]:[2,null]);case 3:i=o.sent(),o.label=4;case 4:if(i&&i.height){for(l=!1,u=0,d=t;u<d.length;u++)if((p=d[u]).height==i.height&&p.width==i.width){l=!0;break}if(!l){if(this._fireLog("got resolution: "+JSON.stringify(i)),delete i.type,t.push(i),null===this._allResolutions)return[2,null];this._allResolutions.push(i)}}o.label=5;case 5:return r++,[3,1];case 6:return this._renderSelResolution(),[2,t]}}))}))},t.prototype.setResolution=function(t,e){return r(this,void 0,void 0,(function(){return o(this,(function(i){switch(i.label){case 0:return this._checkPlugout(),[4,this.play(t,e)];case 1:return[2,i.sent()]}}))}))},t.prototype.getVideoSettings=function(){return JSON.parse(JSON.stringify(this.videoSettings))},t.prototype.updateVideoSettings=function(t){return this.videoSettings=JSON.parse(JSON.stringify(t)),this.play()},t.prototype.destroy=function(){this.unbindResolutionsSelector(),this.stop(),this._cameraInfo=null,this._allCameras=null,this._allResolutions=null,this._videoEle=null},t.prototype.stop=function(){this._videoEle&&this._videoEle.srcObject&&(this._fireLog("======stop video========"),this._videoEle.srcObject.getTracks().forEach((function(t){t.stop()})),this._videoEle.srcObject=null,this._videoTrack=null)},t.prototype.pause=function(){this._videoEle&&this._videoEle.pause()},t.prototype.resume=function(){this._videoEle&&this.paused()&&this.playing()&&this._videoEle.play()},t.prototype.paused=function(){return!!this._videoEle&&this._videoEle.paused},t.prototype.playing=function(){if(this._isPlugOut)return!1;if(this._videoEle&&this._videoEle.srcObject)try{var t=this._videoEle.srcObject;if(t){var e=t.getVideoTracks();if(e&&0!=e.length)return!0}}catch(t){this._fireLog("get video status: "+(t.message||t))}return!1},t.prototype._getMediaTrackConstraints=function(t,e,i,r,o){var n=JSON.parse(JSON.stringify(this.videoSettings));"boolean"==typeof n.video&&(n.video={});var s="exact"==r;if(e&&(n.video.width=s?{exact:e}:{ideal:e}),i&&(n.video.height=s?{exact:i}:{ideal:i}),o&&(e&&(n.video.width={ideal:e}),i&&(n.video.height={ideal:i})),this._browserInfo.mobile&&this._browserInfo.safari&&o&&(n.video.width=n.video.height,delete n.video.height),t)delete n.video.facingMode,n.video.deviceId={exact:t};else if(n.video.facingMode){var a=n.video.facingMode;if(a instanceof Array&&a.length&&(a=a[0]),"environment"===(a=a.exact||a.ideal||a)&&this._allCameras){for(var c=0,h=this._allCameras;c<h.length;c++){var l=h[c],u=l.label.toLowerCase();if(u&&-1!=u.indexOf("facing back")&&/camera[0-9]?\s0,/.test(u)){delete n.video.facingMode,n.video.deviceId={ideal:l.deviceId};break}}n.bFmEnvironment=!!n.video.facingMode}}return n},t.prototype._getMediaStream=function(t,e){return r(this,void 0,void 0,(function(){var i;return o(this,(function(r){switch(r.label){case 0:this._fireLog("======try getUserMedia========"),"boolean"==typeof t.video&&(t.video={}),this._fireLog("ask "+JSON.stringify(t.video.width)+"x"+JSON.stringify(t.video.height)),r.label=1;case 1:return r.trys.push([1,3,,4]),this._fireLog(t),[4,navigator.mediaDevices.getUserMedia(t)];case 2:return[2,r.sent()];case 3:if(i=r.sent(),this._fireLog(i),i.name&&"OverconstrainedError"==i.name){if(e)throw i;return[2,null]}return this._fireLog("======try getUserMedia again========"),this._browserInfo.mobile&&this._browserInfo.safari?(delete t.video.width,delete t.video.height):t.bFmEnvironment?(delete t.video.facingMode,this._allCameras&&this._allCameras.length&&(t.video.deviceId={ideal:this._allCameras[this._allCameras.length-1].deviceId})):t.video=!0,this._fireLog(t),[2,navigator.mediaDevices.getUserMedia(t)];case 4:return[2]}}))}))},t.prototype._supportedResolution=function(t,e){for(var i=0,r=this._allResolutions;i<r.length;i++){var o=r[i];if(o.height==e&&o.width==t)return o.type}return"ideal"},t.prototype.play=function(t,e){return r(this,void 0,void 0,(function(){var i,r,n,s,a,h,l,u,d;return o(this,(function(o){switch(o.label){case 0:this._videoEle||this._pub.emit("onThrowError",c.VIDEO_ELEMENT_REQUIRED),"number"==typeof t&&t>0&&"number"==typeof e&&e>0||(t=this._curResolution?this._curResolution.width:1280,e=this._curResolution?this._curResolution.height:720),i=this._supportedResolution(t,e),this._checkPlugout(),this.stop(),this._fireLog("======before video========"),this.videoSettings=this._getMediaTrackConstraints(this._cameraInfo.deviceId,t,e,i,!0),r=this.videoSettings,n=null,s={},o.label=1;case 1:return o.trys.push([1,3,,4]),[4,this._getMediaStream(r,!0)];case 2:return(n=o.sent())&&(a=n.getVideoTracks()).length&&(this._videoTrack=a[0],s=this._videoTrack.getSettings(),h={deviceId:s.deviceId,label:this._videoTrack.label},this._cameraInfo=h),[3,4];case 3:return l=o.sent(),this._fireLog("======get user media exception========"+(l.message||l)),"NotAllowedError"===l.name||"Permission denied"===l.message?this._pub.emit("onThrowError",c.CAMERA_NOT_OPEN):this._pub.emit("onThrowError",c.FAILED_GET_USERMEDIA),[3,4];case 4:this._videoEle.srcObject=n,this._fireLog("======play video========"),o.label=5;case 5:return o.trys.push([5,7,,10]),[4,this._videoEle.play()];case 6:return o.sent(),[3,10];case 7:return u=o.sent(),this._fireLog("======play video exception========"+(u.message||u)),[4,new Promise((function(t){setTimeout(t,1e3)}))];case 8:return o.sent(),[4,this._videoEle.play()];case 9:return o.sent(),[3,10];case 10:return this._fireLog("======after played video========"),d=s.width?{width:s.width,height:s.height}:{width:this._videoEle.videoWidth,height:this._videoEle.videoHeight},this._curResolution=d,this._pub.emit("onPlayed"),[2,d]}}))}))},t.prototype.getCapabilities=function(){return this._videoTrack.getCapabilities?this._videoTrack.getCapabilities():{}},t.prototype.getCameraSettings=function(){return this._videoTrack.getSettings()},t.prototype.getConstraints=function(){return this._videoTrack.getConstraints()},t.prototype._throwNotSupportException=function(){this._pub.emit("onThrowError",c.CAMERA_SETTINGS_NOT_SUPPORT)},t.prototype._fireLog=function(t){this._pub.emit("onLog",t)},t.prototype.applyConstraints=function(t){return r(this,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return this._videoTrack.applyConstraints||this._throwNotSupportException(),[4,this._videoTrack.applyConstraints(t)];case 1:return[2,e.sent()]}}))}))},t.prototype.turnOnTorch=function(){return r(this,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return this.getCapabilities().torch?[4,this._videoTrack.applyConstraints({advanced:[{torch:!0}]})]:[3,2];case 1:return[2,t.sent()];case 2:this._throwNotSupportException(),t.label=3;case 3:return[2]}}))}))},t.prototype.turnOffTorch=function(){return r(this,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return this.getCapabilities().torch?[4,this._videoTrack.applyConstraints({advanced:[{torch:!1}]})]:[3,2];case 1:return[2,t.sent()];case 2:this._throwNotSupportException(),t.label=3;case 3:return[2]}}))}))},t.prototype.setColorTemperature=function(t){return r(this,void 0,void 0,(function(){var e;return o(this,(function(i){switch(i.label){case 0:return(e=this.getCapabilities().colorTemperature)||this._throwNotSupportException(),t<e.min?t=e.min:t>e.max&&(t=e.max),[4,this._videoTrack.applyConstraints({advanced:[{colorTemperature:t}]})];case 1:return[2,i.sent()]}}))}))},t.prototype.setExposureCompensation=function(t){return r(this,void 0,void 0,(function(){var e;return o(this,(function(i){switch(i.label){case 0:return(e=this.getCapabilities().exposureCompensation)||this._throwNotSupportException(),t<e.min?t=e.min:t>e.max&&(t=e.max),[4,this._videoTrack.applyConstraints({advanced:[{exposureCompensation:t}]})];case 1:return[2,i.sent()]}}))}))},t.prototype.setZoom=function(t){return r(this,void 0,void 0,(function(){var e;return o(this,(function(i){switch(i.label){case 0:return(e=this.getCapabilities().zoom)||this._throwNotSupportException(),t<e.min?t=e.min:t>e.max&&(t=e.max),[4,this._videoTrack.applyConstraints({advanced:[{zoom:t}]})];case 1:return[2,i.sent()]}}))}))},t.prototype.setFrameRate=function(t){return r(this,void 0,void 0,(function(){var e;return o(this,(function(i){switch(i.label){case 0:return(e=this.getCapabilities().frameRate)||this._throwNotSupportException(),t<e.min?t=e.min:t>e.max&&(t=e.max),[4,this._videoTrack.applyConstraints({width:{ideal:Math.max(this._videoEle.videoWidth,this._videoEle.videoHeight)},frameRate:t})];case 1:return[2,i.sent()]}}))}))},t}();e.default=h},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.BrowserDetect=void 0;var r=function(){function t(){this.dataBrowser=[{string:navigator.userAgent,subString:"Edge",identity:"Edge"},{string:navigator.userAgent,subString:"OPR",identity:"OPR"},{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"}],this.dataOS=[{string:navigator.userAgent,subString:"Android",identity:"Android"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone"},{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.platform,subString:"Linux",identity:"Linux"}],this.init()}return t.prototype.init=function(){this.browser=this.searchString(this.dataBrowser)||"unknownBrowser",this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"unknownVersion",this.OS=this.searchString(this.dataOS)||"unknownOS"},t.prototype.searchString=function(t){for(var e=0;e<t.length;e++){var i=t[e].string,r=t[e].prop;if(this.versionSearchString=t[e].versionSearch||t[e].identity,i){if(-1!=i.indexOf(t[e].subString))return t[e].identity}else if(r)return t[e].identity}},t.prototype.searchVersion=function(t){var e=t.indexOf(this.versionSearchString);if(-1!=e)return parseFloat(t.substring(e+this.versionSearchString.length+1))},t.prototype.detectmobilebrowser=function(){var t=window,e=navigator.userAgent||navigator.vendor||t.opera;if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od|ad)|android|playbook|silk|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))return!0;if(null!==e.match(/Macintosh/i)){var i=document.createElement("canvas");if(null!==i){var r=i.getContext("webgl")||i.getContext("experimental-webgl");if(r){var o=r.getExtension("WEBGL_debug_renderer_info");if(o)if(-1!==r.getParameter(o.UNMASKED_RENDERER_WEBGL).indexOf("Apple"))return!0}}}return!1},t}();e.BrowserDetect=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Crop=void 0;var r=function(){function t(t){this.mode=0,this.vertexes=[],this.midpoints=[],this.probePoints=[],this.slopeRatio=[],this.isCrop=!1,this.probePointRadius=6,this.sensorRadius=10,this.defaultLinecolor="rgba(0,0,0,1)",this.defaultFirstPointColor="rgba(255,0,0,1)",this.invalidLineColor="rgba(255,0,0,1)",this.invalidFirstPointColor="rgba(0,0,0,1)",this._lineColor="rgba(0,0,0,1)",this._firstPointColor="rgba(255,0,0,1)",this.pointFillColor="rgba(255,255,255,0)",this.lineWidth=2,this.dashLine=[4,2],this.isPointSelected=!1,this.activeProbePoint=null,this.moveLeft=0,this.moveTop=0,this._StartX=0,this._StartY=0,this.canvasLeft=0,this.canvasTop=0,this.angle=0,this.width=0,this.height=0,this.outerWidth=0,this.outerHeight=0,this.zoomX=1,this.zoomY=1,this._callback=null,this.transformStack=null,this._init(t)}return t.prototype._init=function(t){for(var e=Object.keys(t),i=0,r=e.length;i<r;i++)this[e[i]]=t[e[i]]},t.prototype.bindCallback=function(t){this._callback=t},t.prototype.setZoom=function(t,e){this.zoomX=t,this.zoomY=e},t.prototype.setValidAreaSize=function(t,e){this.outerWidth=t,this.outerHeight=e},t.prototype.setMoveDistance=function(t,e){this.moveLeft=t,this.moveTop=e},t.prototype.setImageSize=function(t,e){this.width=t,this.height=e},t.prototype.setFreeCropBox=function(t){if(this.mode=1,!this.isCrop)return!1;if(8!==t.length)return!1;if(!this.checkRectConvexity(t))return!1;for(var e=0;e<4;e++){var i=this.getPointToCanvas(t[2*e],t[2*e+1]);i=this.transformToCanvasCenterCoordinate(i.x,i.y),t[2*e]=i.x,t[2*e+1]=i.y}return this.vertexes=t.slice(),this.midpoints=this.calcMidpoint(t).slice(),this.probePoints=this.vertexes.slice().concat(this.midpoints.slice()),this.slopeRatio=this.calcSlopeRatio(this.probePoints).slice(0,4),this._publish(),!0},t.prototype.setCropArea=function(t,e,i,r){this.mode=0;var o=[t,e,t+i,e,t+i,e+r,t,e+r];if(!this.isCrop)return!1;if(8!==o.length)return!1;if(!this.checkRectConvexity(o))return!1;for(var n=0;n<4;n++){var s=this.transformToImageCenterCoordinate(o[2*n],o[2*n+1]);s=this.getPointToCanvas(s.x,s.y),o[2*n]=s.x,o[2*n+1]=s.y}return this.vertexes=o.slice(),this.midpoints=this.calcMidpoint(o).slice(),this.probePoints=this.vertexes.slice().concat(this.midpoints.slice()),this.slopeRatio=this.calcSlopeRatio(this.probePoints).slice(0,4),this._publish(),!0},t.prototype.transformToImageCenterCoordinate=function(t,e){return{x:t-=this.width/2,y:e-=this.height/2}},t.prototype.transformToCanvasCenterCoordinate=function(t,e){return{x:t-=this.outerWidth/2,y:e-=this.outerHeight/2}},t.prototype.transformToCanvasLeftTopCoordinate=function(t,e){return{x:t+=this.outerWidth/2,y:e+=this.outerHeight/2}},t.prototype.calcMidpoint=function(t){for(var e=t.slice(0,8).concat(t[0],t[1]),i=[],r=0;r<4;r++){var o=(e[2*r]+e[2*r+2])/2,n=(e[2*r+1]+e[2*r+3])/2;i.push(o,n)}return i},t.prototype.calcSlopeRatio=function(t){for(var e=[],i=null,r=t.slice(0,8).concat(t[0],t[1]),o=0;o<4;o++)i=r[2*o+3]-r[2*o+1]==0&&r[2*o+2]-r[2*o]==0?0:(r[2*o+3]-r[2*o+1])/(r[2*o+2]-r[2*o]),e.push(i);return e},t.prototype.checkRectConvexity=function(t){var e=(t[6]-t[0])*(t[3]-t[1])-(t[7]-t[1])*(t[2]-t[0]),i=(t[0]-t[2])*(t[5]-t[3])-(t[1]-t[3])*(t[4]-t[2]),r=(t[2]-t[4])*(t[7]-t[5])-(t[3]-t[5])*(t[6]-t[4]),o=(t[4]-t[6])*(t[1]-t[7])-(t[5]-t[7])*(t[0]-t[6]);if(e*i*r*o<0)return!1;var n=t.slice().concat(t.slice(0,2));if(this.slopeRatio.length)for(var s=0;s<2;s++){if(this.slopeRatio[s]!==this.slopeRatio[s+2])if(this.calcIntersection(n.slice(2*s,2*s+2),n.slice(2*s+2,2*s+4),n.slice(2*s+4,2*s+6),n.slice(2*s+6,2*s+8)))return!1}return e*i*r*o>0},t.prototype.checkImageEdge=function(t,e){var i=this.getPointToCanvas(0,0),r=this.getPointToCanvas(this.width,this.height),o=r.x-i.x,n=r.y-i.y;return t>=-o/2&&t<=o/2&&e>=-n/2&&e<=n/2},t.prototype.getPointToImage=function(t,e){return{x:t=(t-(this.outerWidth/2-this.width*this.zoomX/2-this.moveLeft))/this.zoomX,y:e=(e-(this.outerHeight/2-this.height*this.zoomY/2-this.moveTop))/this.zoomY}},t.prototype.getPointToCanvas=function(t,e){return{x:t=t*this.zoomX+(this.outerWidth/2-this.width*this.zoomX/2-this.moveLeft),y:e=e*this.zoomY+(this.outerHeight/2-this.height*this.zoomY/2-this.moveTop)}},t.prototype.checkProbePoint=function(t,e){for(var i=this.sensorRadius,r=0;r<8;r++){var o=this.probePoints[2*r],n=this.probePoints[2*r+1],s={x:t,y:e};if(this.transformStack&&(s=this.transformStack.setPointTransform(t,e)),s.x<=o+i&&s.x>=o-i&&s.y<=n+i&&s.y>=n-i)return r}return null},t.prototype.pointRotate=function(t,e,i,r,o){return o%360?(o=o/180*Math.PI,{x:(t-i)*Math.cos(o)-(e-r)*Math.sin(o)+i,y:(t-i)*Math.sin(o)+(e-r)*Math.cos(o)+r}):{x:t,y:e}},t.prototype.onStartHandler=function(t){if(this.isCrop){var e=void 0!==t.clientX?t.clientX:t.changedTouches[0].clientX,i=void 0!==t.clientY?t.clientY:t.changedTouches[0].clientY;this._StartX=e-this.canvasLeft,this._StartY=i-this.canvasTop;var r={x:this._StartX,y:this._StartY};r=this.transformToCanvasCenterCoordinate(r.x,r.y);var o=this.checkProbePoint(r.x,r.y);null!==o?(this.isPointSelected=!0,this.activeProbePoint=o):(this.isPointSelected=!1,this.activeProbePoint=null)}},t.prototype.onMoveHandler=function(t){if(this.isPointSelected&&null!==this.activeProbePoint){var e=void 0!==t.clientX?t.clientX:t.changedTouches[0].clientX,i=void 0!==t.clientY?t.clientY:t.changedTouches[0].clientY,r=e-this.canvasLeft,o=i-this.canvasTop,n=this.activeProbePoint,s=this.transformToCanvasCenterCoordinate(r,o);this.transformStack&&(s=this.transformStack.setPointTransform(s.x,s.y));var a=s.x,c=s.y,h=this.probePoints.slice();h=0===this.mode?this._moveNormalCropBox(h,n,a,c):this._moveFreeCropBox(h,n,a,c);for(var l=!1,u=0;u<4;u++){if(!this.checkImageEdge(h[2*u],h[2*u+1])){l=!0;break}}l||(this.probePoints=h.slice()),this.checkRectConvexity(this.probePoints)?(this._lineColor=this.defaultLinecolor,this._firstPointColor=this.defaultFirstPointColor):(this._lineColor=this.invalidLineColor,this._firstPointColor=this.invalidFirstPointColor);var d=this.calcMidpoint(this.probePoints);this.probePoints=this.probePoints.slice(0,8).concat(d),this._publish()}},t.prototype.onEndHandler=function(t){var e=void 0!==t.clientX?t.clientX:t.changedTouches[0].clientX,i=void 0!==t.clientY?t.clientY:t.changedTouches[0].clientY,r=e-this.canvasLeft,o=i-this.canvasTop,n=this._StartX,s=this._StartY;if(this._StartX=0,this._StartY=0,this._lineColor=this.defaultLinecolor,this._firstPointColor=this.defaultFirstPointColor,this.isPointSelected&&null!==this.activeProbePoint){this.activeProbePoint=null,this.isPointSelected=!1;var a=this.checkRectConvexity(this.probePoints);if(n===r&&s===o||!a)return this.probePoints=this.vertexes.slice().concat(this.midpoints),this.slopeRatio=this.calcSlopeRatio(this.probePoints).slice(0,4),void this._publish();this.vertexes=this.probePoints.slice(0,8),this.midpoints=this.probePoints.slice(8,16),this._publish()}},t.prototype._moveNormalCropBox=function(t,e,i,r){if(e<4){var o=i-t[2*e],n=r-t[2*e+1];t[2*e]=i,t[2*e+1]=r;var s=(e+1)%4,a=(e+3)%4;e%2?(t[2*s]+=o,t[2*a+1]+=n):(t[2*s+1]+=o,t[2*a]+=n)}else{var c=e-4,h=this.slopeRatio[c%4];0===h?(t[(2*c+3)%8]=r,t[(2*c+1)%8]=r):h!==1/0&&h!==-1/0||(t[(2*c+2)%8]=i,t[(2*c+0)%8]=i)}return t},t.prototype._moveFreeCropBox=function(t,e,i,r){if(e<4){var o=this.getPointToCanvas(0,0),n=this.getPointToCanvas(this.width,this.height),s=n.x-o.x,a=n.y-o.y;t[2*e]=i,t[2*e+1]=r,t[2*e]=Math.min(Math.max(-s/2,t[2*e]),s/2),t[2*e+1]=Math.min(Math.max(-a/2,t[2*e+1]),a/2),this.slopeRatio=this.calcSlopeRatio(this.probePoints).slice(0,4)}else{var c=e-4,h=this.slopeRatio[c%4],l=1*r-h*i,u=-l/h,d=1*t[(2*c+9)%8]-h*t[(2*c+8)%8],p=-d/h,f=this.slopeRatio[(c+1)%4],v=1*t[(2*c+3)%8]-f*t[(2*c+2)%8],_=this.slopeRatio[(c+3)%4],m=1*t[(2*c+1)%8]-_*t[(2*c+0)%8];0===h?(t[(2*c+3)%8]=r,f!==1/0&&f!==-1/0&&(t[(2*c+2)%8]=(1*r-v)/f),t[(2*c+1)%8]=r,_!==1/0&&_!==-1/0&&(t[(2*c+0)%8]=(1*r-m)/_)):h===1/0||h===-1/0?(t[(2*c+2)%8]=i,t[(2*c+3)%8]=(f*i+v)/1,t[(2*c+0)%8]=i,t[(2*c+1)%8]=(_*i+m)/1):(0===f?t[(2*c+2)%8]+=u-p:f===1/0||f===-1/0?t[(2*c+3)%8]+=l-d:(t[(2*c+2)%8]=(1*v-1*l)/(1*h-1*f),t[(2*c+3)%8]=(f*l-h*v)/(1*f-1*h)),0===_?t[(2*c+0)%8]+=u-p:_===1/0||_===-1/0?t[(2*c+1)%8]+=l-d:(t[(2*c+0)%8]=(1*m-1*l)/(1*h-1*_),t[(2*c+1)%8]=(_*l-h*m)/(1*_-1*h)))}return t},t.prototype._publish=function(){if(this._callback){for(var t=this.probePoints.slice(0,8),e=0;e<4;e++){var i=this.transformToCanvasLeftTopCoordinate(t[2*e],t[2*e+1]);i=this.getPointToImage(i.x,i.y),t[2*e]=i.x,t[2*e+1]=i.y}this._callback(t.slice())}},t.prototype.calcIntersection=function(t,e,i,r){if(this._isRectCross(t,e,i,r)&&this._isLineSegmentCross(t,e,i,r)){var o,n=void 0,s=void 0;if(n=(r[0]-i[0])*(t[1]-e[1])-(e[0]-t[0])*(i[1]-r[1]),s=(t[1]-i[1])*(e[0]-t[0])*(r[0]-i[0])+i[0]*(r[1]-i[1])*(e[0]-t[0])-t[0]*(e[1]-t[1])*(r[0]-i[0]),0===n||0===s){var a=this._getLine(t,e),c=this._getLine(i,r),h=a[0],l=a[1],u=c[0],d=c[1];if(l[0]===u[0]&&l[1]===u[1])return l;if(h[0]===d[0]&&h[1]===d[1])return h;if(this._isOnLine(l,c)&&this._isOnLine(u,a))return[u,l];if(this._isOnLine(h,c)&&this._isOnLine(d,a))return[h,d];if(this._isOnLine(h,c)&&this._isOnLine(l,c))return[h,l];if(this._isOnLine(u,c)&&this._isOnLine(d,c))return[u,d]}return o=s/n,n=(t[0]-e[0])*(r[1]-i[1])-(e[1]-t[1])*(i[0]-r[0]),[o,(s=e[1]*(t[0]-e[0])*(r[1]-i[1])+(r[0]-e[0])*(r[1]-i[1])*(t[1]-e[1])-r[1]*(i[0]-r[0])*(e[1]-t[1]))/n]}return!1},t.prototype._getLine=function(t,e){return t[0]===e[0]?t[1]<e[1]?[t,e]:[e,t]:t[0]<e[0]?[t,e]:[e,t]},t.prototype._isOnLine=function(t,e){return e[0][0]===e[1][0]?t[1]>=e[0][1]&&t[1]<=e[1][1]:t[0]>=e[0][0]&&t[0]<=e[1][0]},t.prototype._isRectCross=function(t,e,i,r){var o=Math.min,n=Math.max;return o(t[0],e[0])<=n(i[0],r[0])&&o(i[0],r[0])<=n(t[0],e[0])&&o(t[1],e[1])<=n(i[1],r[1])&&o(i[1],r[1])<=n(t[1],e[1])},t.prototype._isLineSegmentCross=function(t,e,i,r){var o,n;return!(((o=t[0]*(i[1]-e[1])+e[0]*(t[1]-i[1])+i[0]*(e[1]-t[1]))^(n=t[0]*(r[1]-e[1])+e[0]*(t[1]-r[1])+r[0]*(e[1]-t[1])))>=0&&0!==o&&0!==n)&&!(((o=i[0]*(t[1]-r[1])+r[0]*(i[1]-t[1])+t[0]*(r[1]-i[1]))^(n=i[0]*(e[1]-r[1])+r[0]*(i[1]-e[1])+e[0]*(r[1]-i[1])))>=0&&0!==o&&0!==n)},t}();e.Crop=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(){}return t.cameraException=function(t,e){var i={};return(i=new Error(e||t.message)).code=t.code,i},t}();e.default=r},function(t,e,i){"use strict";var r=this&&this.__spreadArrays||function(){for(var t=0,e=0,i=arguments.length;e<i;e++)t+=arguments[e].length;var r=Array(t),o=0;for(e=0;e<i;e++)for(var n=arguments[e],s=0,a=n.length;s<a;s++,o++)r[o]=n[s];return r};Object.defineProperty(e,"__esModule",{value:!0}),e.PublishSubscribe=void 0;var o=function(){function t(){this._events=[]}return t.prototype.on=function(t,e){this._events[t]||(this._events[t]=[]),this._events[t].push(e)},t.prototype.emit=function(t){for(var e,i=[],o=1;o<arguments.length;o++)i[o-1]=arguments[o];var n=this._events[t];if(!n||0===n.length)return!1;for(var s=n.length,a=0;a<s;a++)(e=n[a]).call.apply(e,r([null],i))},t.prototype.off=function(t,e){var i=this._events[t];if(!i)return!1;if(e)for(var r=i.length,o=0;o<r;o++){i[o]===e&&i.splice(o,1)}else i&&(i.length=0)},t}();e.PublishSubscribe=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={isArray:function(t){return Array.isArray?Array.isArray(t):"[object Array]"===Object.prototype.toString.call(t)},isObject:function(t){return"[object Object]"===Object.prototype.toString.call(t)},isFunction:function(t){return"function"==typeof t},isString:function(t){return"string"==typeof t},isNumber:function(t){return"number"==typeof t&&!isNaN(t)},isBoolean:function(t){return"[object Boolean]"===Object.prototype.toString.call(t)},isElement:function(t){return t instanceof HTMLElement},mergeJSON:function(t,e){for(var i in t)void 0===e[i]?e[i]=t[i]:this.isObject(t[i])?this.mergeJSON(t[i],e[i]):e[i]=t[i]},rValue:function(t){return void 0===t?"":t}}},function(t,e,i){}]);